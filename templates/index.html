<!DOCTYPE html>
<html lang="en">
<head>
    {% include "partials/head.html" %}
</head>
<body>
    <div class="container">
        <div class="full-width" style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end;">
            <h1>EVE Looter <small>ZKillboard Parser</small></h1>
        </div>

        {% if let Some(err) = error_msg %}
        <div class="full-width error"><strong>Error:</strong> {{ err }}</div>
        {% endif %}

        <form id="mainForm" action="/process" method="POST" class="full-width" style="display: contents;">
            <!-- Hidden inputs for exclusions -->
            <input type="hidden" id="excluded_input" name="excluded_kills" value="">
            <input type="hidden" id="excluded_ben_input" name="excluded_beneficiaries" value="">
            
            {% include "partials/configuration.html" %}
            {% include "partials/payout.html" %}
            {% include "partials/kill_list.html" %}
        </form>
    </div>

    <script>
        function submitForm() {
            // 1. Collect Excluded Kills
            const killCBs = document.querySelectorAll('input[name="active_kill"]');
            let excludedKills = [];
            killCBs.forEach((cb) => { 
                if (!cb.checked) excludedKills.push(cb.value); 
            });
            document.getElementById('excluded_input').value = excludedKills.join(',');

            // 2. Collect Excluded Beneficiaries
            const benCBs = document.querySelectorAll('input[name="active_beneficiary"]');
            let excludedBen = [];
            benCBs.forEach((cb) => { 
                if (!cb.checked) excludedBen.push(cb.value); 
            });
            document.getElementById('excluded_ben_input').value = excludedBen.join(',');

            // 3. Submit
            document.getElementById('mainForm').submit();
        }
    </script>
</body>
</html>
